(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a79fca64"],{"161b":function(t,e,i){},"1b25":function(t,e,i){},2494:function(t,e,i){"use strict";i("161b")},"33a5":function(t){t.exports=JSON.parse('{"0":"江湖","1":"天策","2":"万花","3":"纯阳","4":"七秀","5":"少林","6":"藏剑","7":"丐帮","8":"明教","9":"五毒","10":"唐门","18":"苍云","19":"长歌","20":"霸刀","21":"蓬莱","22":"凌雪","23":"衍天","24":"药宗","26":"刀宗","29":"万灵","38":"段氏"}')},"5d98":function(t,e,i){},"6cc1":function(t,e,i){"use strict";i("1b25")},9530:function(t,e,i){"use strict";i("b0c0");var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-upload"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-upload",disabled:!t.enable},on:{click:function(e){t.dialogVisible=!0}}},[t._v(t._s(t.btn_txt))]),e("el-dialog",{staticClass:"c-large-dialog",attrs:{title:"上传",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-button",{staticClass:"u-upload-clear",attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:t.clear}},[t._v("清空")]),e("el-alert",{staticClass:"u-upload-tip",attrs:{title:t.tip,type:"info","show-icon":"",closable:!1}}),e("el-upload",{ref:"uploadbox",attrs:{action:t.API,"list-type":"picture-card","auto-upload":!1,limit:10,multiple:"","with-credentials":"","file-list":t.fileList,"on-change":t.change,accept:t.accept},scopedSlots:t._u([{key:"file",fn:function(i){var s=i.file;return e("div",{staticClass:"u-file-wrapper",class:{isSelected:s.selected,disabled:"success"!=s.status},on:{click:function(e){return t.select(s)}}},[s.is_img?e("img",{staticClass:"el-upload-list__item-thumbnail u-imgbox",attrs:{src:s.url,alt:""}}):e("div",{staticClass:"u-filebox"},[e("svg",{class:"u-fileplaceholder",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 469.333 469.333","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{d:"M466.208 88.458L380.875 3.125c-2-2-4.708-3.125-7.542-3.125H42.667C19.146 0 0 19.135 0 42.667v384c0 23.531 19.146 42.667 42.667 42.667h384c23.521 0 42.667-19.135 42.667-42.667V96a10.665 10.665 0 00-3.126-7.542zM106.667 21.333h234.667v128c0 11.76-9.563 21.333-21.333 21.333H128c-11.771 0-21.333-9.573-21.333-21.333v-128zM384 448H85.333V256H384v192zm64-21.333c0 11.76-9.563 21.333-21.333 21.333h-21.333V245.333a10.66 10.66 0 00-10.667-10.667h-320A10.66 10.66 0 0064 245.333V448H42.667c-11.771 0-21.333-9.573-21.333-21.333v-384c0-11.76 9.563-21.333 21.333-21.333h42.667v128C85.333 172.865 104.479 192 128 192h192c23.521 0 42.667-19.135 42.667-42.667v-128h6.25L448 100.417v326.25z"}}),e("path",{attrs:{d:"M266.667 149.333h42.667a10.66 10.66 0 0010.667-10.667V53.333a10.66 10.66 0 00-10.667-10.667h-42.667A10.66 10.66 0 00256 53.333v85.333a10.66 10.66 0 0010.667 10.667zM277.333 64h21.333v64h-21.333V64z"}})]),e("span",{staticClass:"u-filename"},[t._v(t._s(s.name))])]),e("label",{directives:[{name:"show",rawName:"v-show",value:s.selected,expression:"file.selected"}],staticClass:"u-file-select-label"},[e("i",{staticClass:"el-icon-upload-success el-icon-check"})])])}}])},[e("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.insert}},[t._v(" "+t._s(t.buttonTXT)+" ")])],1)],1)],1)},a=[],n=(i("99af"),i("caad"),i("a15b"),i("14d9"),i("a434"),i("e9f5"),i("7d54"),i("a9e3"),i("d3b7"),i("159b"),i("9ec4")),l=i.n(n),c=i("65c2"),o=(i("c5d8"),c["__cms"]),u=o+"api/cms/upload",r=["jpg","png","gif","bmp","webp","jpeg","JPG","PNG","GIF","BMP","WEBP","JPEG"],d={name:"Upload",props:{text:{type:String},onlyImage:{type:Boolean},desc:{type:String},accept:{type:String},enable:{type:Boolean,default:!0},max:{type:Number,default:10},sizeLimit:{type:Number,default:30}},data:function(){return{API:u,dialogVisible:!1,tip:this.desc||"一次最多同时上传".concat(this.max,"个文件（单个文件不超过").concat(this.sizeLimit,"M），格式限常见的图片、文档、数据表及压缩包"),btn_txt:this.text||"上传附件",fileList:[],selectedCount:0,insertList:""}},watch:{fileList:{deep:!0,handler:function(t){this.$emit("update",t)}},insertList:function(t){this.$emit("htmlUpdate",t)}},computed:{buttonTXT:function(){return this.selectedCount?"插 入":"确 定"}},methods:{change:function(t,e){var i=this;if("success"!=t.status){var s=t.name.split(".").pop(),a=r.includes(s);if(this.onlyImage&&!a)return;var n=new FormData;n.append("file",t.raw),l.a.post(u,n,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0,auth:{username:localStorage&&localStorage.getItem("token")||"",password:"cms common request"}}).then((function(e){e.data.code?i.$message({message:e.data.msg,type:"error"}):(i.$message({message:"上传成功",type:"success"}),t.url=e.data.data&&e.data.data[0],t.is_img=a,t.selected=!0,t.status="success",i.fileList.push(t),i.selectedCount++)})).catch((function(t){t.response.data.code?i.$message.error("[".concat(t.response.data.code,"] ").concat(t.response.data.message)):i.$message.error("请求异常")}))}},select:function(t){"success"==t.status&&(this.$set(t,"selected",!t.selected),t.selected?this.selectedCount++:this.selectedCount--)},buildHTML:function(){var t=[];return this.fileList.forEach((function(e){e.selected&&(e.is_img?t.push('<img src="'.concat(e.url,'" />')):t.push('<a target="_blank" href="'.concat(e.url,'">').concat(e.name,"</a>")))})),this.insertList=t.join(" \n"),this.insertList},insert:function(){this.dialogVisible=!1,this.selectedCount&&(this.$emit("insert",{list:this.fileList,html:this.buildHTML()}),this.resetSelectStatus())},resetSelectStatus:function(){var t=this;this.fileList.forEach((function(e,i){t.$set(t.fileList[i],"selected",!1)})),this.selectedCount=0},clear:function(){this.$refs.uploadbox.clearFiles(),this.fileList=[]},removeFile:function(t,e){t.forEach((function(i,s){i.uid==e&&t.splice(s,1)}))}},mounted:function(){},components:{}},p=d,m=(i("f8fb"),i("2877")),f=Object(m["a"])(p,s,a,!1,null,null,null);e["a"]=f.exports},b49b:function(t,e,i){"use strict";i.d(e,"g",(function(){return a})),i.d(e,"c",(function(){return l})),i.d(e,"i",(function(){return n})),i.d(e,"e",(function(){return c})),i.d(e,"a",(function(){return o})),i.d(e,"k",(function(){return u})),i.d(e,"h",(function(){return r})),i.d(e,"j",(function(){return d})),i.d(e,"d",(function(){return p})),i.d(e,"f",(function(){return m})),i.d(e,"b",(function(){return f}));var s=i("41cb");function a(t){return Object(s["$cms"])().post("/api/cms/post/emotion",t)}function n(t,e){return Object(s["$cms"])().put("/api/cms/post/emotion/".concat(t),e)}function l(t){return Object(s["$cms"])().get("/api/cms/post/emotion/".concat(t))}function c(t){return Object(s["$cms"])().get("/api/cms/post/emotions/my",{params:t})}function o(t){return Object(s["$cms"])().delete("/api/cms/post/emotion/".concat(t))}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emotions";return Object(s["$next"])().post("/api/".concat(e,"/upload"),t)}function r(t){return Object(s["$next"])().post("/api/joke/share",t)}function d(t){return Object(s["$next"])().put("/api/joke/share/".concat(t.id),t)}function p(t){return Object(s["$cms"])().get("/api/cms/post/joke/".concat(t))}function m(t){return Object(s["$cms"])().get("/api/cms/post/jokes/my",{params:t})}function f(t){return Object(s["$cms"])().delete("/api/cms/post/joke/".concat(t))}},b800:function(t,e,i){"use strict";i("5d98")},ba82:function(t,e,i){"use strict";i("b0c0");var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-header"},[e("el-page-header",{attrs:{content:t.name},on:{back:t.goBack}}),t._t("default")],2)},a=[],n=(i("14d9"),{name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){window.history.length?this.$router.go(-1):this.$router.push("/")}},mounted:function(){},components:{}}),l=n,c=(i("b800"),i("2877")),o=Object(c["a"])(l,s,a,!1,null,null,null);e["a"]=o.exports},e917:function(t,e,i){},f18d:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-publish-box m-publish-box-emotion"},[e("publish-header",{attrs:{name:"剑三表情"}}),e("el-form",{attrs:{"label-position":"left","label-width":"80px"}},[t.id?e("div",{staticClass:"m-publish-emotion m-publish-emotion-edit"},[e("el-form-item",{attrs:{label:"图片"}},[t.data&&t.data.url?e("div",{staticClass:"u-pic"},[e("img",{staticClass:"u-img",attrs:{src:t._f("showThumbnail")(t.data.url)}}),e("i",{staticClass:"u-mask"}),e("i",{staticClass:"u-preview",on:{click:function(e){return t.previewHandle(t.data)}}},[e("i",{staticClass:"el-icon-zoom-in"})])]):t._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.data.url,expression:"!data.url"}],staticClass:"m-emotion-upload"},[t.data&&t.data.url?e("div",{staticClass:"u-emotion"},[e("img",{attrs:{src:t.data.url}}),e("i",{staticClass:"u-emotion-mask"}),e("i",{staticClass:"u-emotion-delete el-icon-delete",attrs:{title:"移除"},on:{click:t.handleRemove}})]):e("div",{staticClass:"u-upload el-upload el-upload--picture-card",on:{click:t.select}},[e("i",{staticClass:"el-icon-plus"})]),e("input",{ref:"uploadInput",staticClass:"u-upload-input",attrs:{type:"file"},on:{change:t.upload}})]),t.data&&t.data.url?e("el-button",{staticClass:"u-remove-btn",attrs:{icon:"el-icon-delete",size:"mini"},on:{click:t.removePic}},[t._v("移除")]):t._e()],1),e("el-form-item",{attrs:{label:"描述"}},[e("el-input",{attrs:{maxlength:120,"show-word-limit":"",placeholder:"图片说明"},model:{value:t.data.desc,callback:function(e){t.$set(t.data,"desc",e)},expression:"data.desc"}})],1),e("el-form-item",{attrs:{label:"类别"}},[e("el-select",{attrs:{placeholder:"选择门派（非必选）"},model:{value:t.data.type,callback:function(e){t.$set(t.data,"type",e)},expression:"data.type"}},t._l(t.schoolmap,(function(i,s){return e("el-option",{key:s,attrs:{value:s,label:i}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticClass:"u-icon",staticStyle:{"margin-right":"20px"},attrs:{width:"24",height:"24",src:t._f("showSchoolIcon")(s),alt:i}}),t._v(" "+t._s(i)+" ")])])})),1)],1),e("el-form-item",{attrs:{label:"原创"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.data.original,callback:function(e){t.$set(t.data,"original",t._n(e))},expression:"data.original"}})],1),e("el-form-item",{attrs:{label:"原作者"}},[e("el-input",{attrs:{placeholder:"（非必填）"},model:{value:t.data.author,callback:function(e){t.$set(t.data,"author",e)},expression:"data.author"}})],1),e("div",{staticClass:"m-publish-buttons"},[e("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:t.update}},[t._v("更    新")])],1)],1):e("div",{staticClass:"m-publish-emotion m-publish-emotion-create"},[e("div",{staticClass:"m-publish-emotion-bulk"},[e("h1",{staticClass:"u-title"},[t._v("上传表情")]),e("UploadEmotion",{attrs:{text:"批量上传图片",onlyImage:!0,desc:"一次最多同时上传10个文件（不超过5M）",accept:t.supportTypes},on:{insert:t.updateFileList}}),e("div",{staticClass:"u-tip"},[e("i",{staticClass:"el-icon-info"}),t._v(" 图片格式支持gif/png/jpg/bmp/webp ")])],1),t.list&&t.list.length?e("div",{staticClass:"m-publish-emotion-list"},[e("div",{staticClass:"u-list"},t._l(t.list,(function(i,s){return e("div",{key:s,staticClass:"u-item"},[e("div",{staticClass:"u-div"},[e("i",{staticClass:"u-order"},[t._v(t._s(s+1))]),e("div",{staticClass:"u-op"},[e("el-button",{staticClass:"u-delete",attrs:{icon:"el-icon-delete",type:"info",size:"mini"},on:{click:function(e){return t.deleteHandle(s)}}},[t._v("删除")])],1)]),e("div",{staticClass:"u-pic"},[e("img",{staticClass:"u-img",attrs:{src:t._f("showThumbnail")(i.url)}}),e("i",{staticClass:"u-mask"}),e("i",{staticClass:"u-preview",on:{click:function(e){return t.previewHandle(i)}}},[e("i",{staticClass:"el-icon-zoom-in"})])]),e("div",{staticClass:"u-desc"},[e("el-input",{attrs:{maxlength:120,"show-word-limit":"",placeholder:"图片说明"},model:{value:i.desc,callback:function(e){t.$set(i,"desc",e)},expression:"item.desc"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("描述")])])],1),e("div",{staticClass:"u-extend"},[e("el-switch",{attrs:{"inactive-text":"原创","active-value":1,"inactive-value":0},model:{value:i.original,callback:function(e){t.$set(i,"original",t._n(e))},expression:"item.original"}}),i.original?t._e():e("el-input",{staticClass:"u-author",attrs:{placeholder:"（非必填）",size:"mini"},model:{value:i.author,callback:function(e){t.$set(i,"author",e)},expression:"item.author"}},[e("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("原作者")])]),e("el-select",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",placeholder:"请选择门派（非必选）"},model:{value:i.type,callback:function(e){t.$set(i,"type",e)},expression:"item.type"}},t._l(t.schoolmap,(function(s,a){return e("el-option",{key:a,attrs:{value:a,label:s}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("img",{staticClass:"u-icon",staticStyle:{"margin-right":"20px"},attrs:{width:"24",height:"24",src:t._f("showSchoolIcon")(a),alt:i}}),t._v(" "+t._s(s)+" ")])])})),1)],1)])})),0),e("div",{staticClass:"m-publish-buttons"},[e("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:t.publish}},[t._v("发    布")])],1)]):t._e()])]),e("el-dialog",{staticClass:"m-publish-emotion-preview",attrs:{visible:t.dialogVisible,title:"预览"},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("img",{attrs:{src:t.dialogImageUrl}})])],1)},a=[],n=(i("99af"),i("14d9"),i("a434"),i("b0c0"),i("e9f5"),i("7d54"),i("d3b7"),i("159b"),i("85e4")),l=i("33a5"),c=i("65c2"),o=i("ba82"),u=(i("9530"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"c-upload"},[e("el-button",{attrs:{type:"primary",icon:"el-icon-upload",disabled:!t.enable},on:{click:function(e){t.dialogVisible=!0}}},[t._v(t._s(t.btn_txt))]),e("el-dialog",{staticClass:"c-large-dialog",attrs:{title:"上传",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[e("el-button",{staticClass:"u-upload-clear",attrs:{plain:"",icon:"el-icon-delete",size:"mini"},on:{click:t.clear}},[t._v("清空")]),e("el-alert",{staticClass:"u-upload-tip",attrs:{title:t.tip,type:"info","show-icon":"",closable:!1}}),e("el-upload",{ref:"uploadbox",attrs:{action:"","list-type":"picture-card","auto-upload":!1,limit:10,multiple:"","with-credentials":"","file-list":t.fileList,"on-change":t.change,accept:t.accept},scopedSlots:t._u([{key:"file",fn:function(i){var s=i.file;return e("div",{staticClass:"u-file-wrapper",class:{isSelected:s.selected,disabled:"success"!=s.status},on:{click:function(e){return t.select(s)}}},[s.is_img?e("img",{staticClass:"el-upload-list__item-thumbnail u-imgbox",attrs:{src:s.url,alt:""}}):t._e(),e("label",{directives:[{name:"show",rawName:"v-show",value:s.selected,expression:"file.selected"}],staticClass:"u-file-select-label"},[e("i",{staticClass:"el-icon-upload-success el-icon-check"})])])}}])},[e("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.insert}},[t._v(" "+t._s(t.buttonTXT)+" ")])],1)],1)],1)}),r=[],d=(i("caad"),i("a15b"),i("a9e3"),i("b49b")),p=["jpg","png","gif","bmp","webp","jpeg","JPG","PNG","GIF","BMP","WEBP","JPEG"],m={name:"Upload",props:{text:{type:String},onlyImage:{type:Boolean},desc:{type:String},accept:{type:String},enable:{type:Boolean,default:!0},max:{type:Number,default:10},sizeLimit:{type:Number,default:5}},data:function(){return{dialogVisible:!1,tip:this.desc||"一次最多同时上传".concat(this.max,"个文件（单个文件不超过").concat(this.sizeLimit,"M），格式限常见的图片、文档、数据表及压缩包"),btn_txt:this.text||"上传附件",fileList:[],selectedCount:0,insertList:""}},watch:{fileList:{deep:!0,handler:function(t){this.$emit("update",t)}},insertList:function(t){this.$emit("htmlUpdate",t)}},computed:{buttonTXT:function(){return this.selectedCount?"插 入":"确 定"}},methods:{change:function(t,e){var i=this;if("success"!=t.status){var s=t.name.split(".").pop(),a=p.includes(s);if(this.onlyImage&&!a)return;var n=new FormData;n.append("file",t.raw),Object(d["k"])(n).then((function(e){e.data.code?i.$message({message:e.data.msg,type:"error"}):(i.$message({message:"上传成功",type:"success"}),t.url=e.data.data&&c["__cdn"]+e.data.data[0],t.is_img=a,t.selected=!0,t.status="success",i.fileList.push(t),i.selectedCount++)})).catch((function(t){t.response.data.code?i.$message.error("[".concat(t.response.data.code,"] ").concat(t.response.data.message)):i.$message.error("请求异常")}))}},select:function(t){"success"==t.status&&(this.$set(t,"selected",!t.selected),t.selected?this.selectedCount++:this.selectedCount--)},buildHTML:function(){var t=[];return this.fileList.forEach((function(e){e.selected&&(e.is_img?t.push('<img src="'.concat(e.url,'" />')):t.push('<a target="_blank" href="'.concat(e.url,'">').concat(e.name,"</a>")))})),this.insertList=t.join(" \n"),this.insertList},insert:function(){this.dialogVisible=!1,this.selectedCount&&(this.$emit("insert",{list:this.fileList,html:this.buildHTML()}),this.resetSelectStatus())},resetSelectStatus:function(){var t=this;this.fileList.forEach((function(e,i){t.$set(t.fileList[i],"selected",!1)})),this.selectedCount=0},clear:function(){this.$refs.uploadbox.clearFiles(),this.fileList=[]},removeFile:function(t,e){t.forEach((function(i,s){i.uid==e&&t.splice(s,1)}))}},mounted:function(){},components:{}},f=m,h=(i("6cc1"),i("2877")),b=Object(h["a"])(f,u,r,!1,null,null,null),g=b.exports,v={name:"emotion",components:{"publish-header":o["a"],UploadEmotion:g},data:function(){return{loading:!1,processing:!1,schoolmap:l,supportTypes:"image/png, image/jpeg, image/gif, image/bmp, image/webp",list:[],data:{},dialogImageUrl:"",dialogVisible:!1}},computed:{id:function(){return~~this.$route.params.id},fileInput:function(){return this.$refs.uploadInput}},methods:{init:function(){var t=this;this.loading=!0,Object(d["c"])(this.id).then((function(e){var i;t.data=null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i.data})).finally((function(){t.loading=!1}))},updateFileList:function(t){var e=t.list,i=[];e.forEach((function(t){t.is_img&&i.push({desc:t.name,url:t.url,original:0,author:"",type:""})})),this.list=this.list.concat(i)},previewHandle:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0},deleteHandle:function(t){this.list.splice(t,1)},publish:function(){var t=this;this.processing=!0,Object(d["g"])(this.list).then((function(e){t.$message({message:"发布成功,请等待审核",type:"success"}),t.list=[]})).finally((function(){t.processing=!1}))},update:function(){var t,e=this;null!==(t=this.data)&&void 0!==t&&t.url?(this.processing=!0,Object(d["i"])(this.id,this.data).then((function(t){e.$message({message:"更新成功,请等待审核",type:"success"}),setTimeout((function(){location.href=Object(n["getLink"])("emotion",e.id)}),500)})).finally((function(){e.processing=!1}))):this.$message({message:"图片不能为空",type:"warning"})},removePic:function(){this.data.url=""},select:function(){this.fileInput.dispatchEvent(new MouseEvent("click"))},upload:function(){var t=this,e=new FormData;e.append("file",this.fileInput.files[0]),Object(d["k"])(e).then((function(e){t.data.url=c["__cdn"]+e.data.data[0],t.$message({message:"上传成功",type:"success"}),t.fileInput.files=[]}))},handleRemove:function(){this.data.url=""}},watch:{"$route.params.id":{immediate:!0,handler:function(t){t&&this.init()}}},filters:{showThumbnail:function(t){return Object(n["getThumbnail"])(t,146)},showSchoolIcon:function(t){return c["__imgPath"]+"image/school/"+t+".png"}}},C=v,_=(i("2494"),Object(h["a"])(C,s,a,!1,null,null,null));e["default"]=_.exports},f8fb:function(t,e,i){"use strict";i("e917")}}]);