(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33d2356e"],{"500d":function(t,e,s){"use strict";s.d(e,"a",(function(){return o}));var i=s("41cb");const a=(t,e)=>Object(i["$node"])().get("/pet/"+t,{params:e}),n=location.href.includes("origin")?"origin":"std",o={latest({type:t},e){return Object(i["$cms"])().get("/api/cms/wiki/post/latest",{params:{client:n,...e,type:t}})},mine(t){return Object(i["$cms"])().get("/api/cms/wiki/post/mine",{params:t})},counter({type:t},e){return Object(i["$cms"])().get("/api/cms/wiki/post/counter",{params:{client:n,...e,type:t}})},achievements(t){return Object(i["$node"])().get("/achievement/list",{params:{client:n,...t}})},get({type:t,id:e},s){return Object(i["$cms"])().get(`/api/cms/wiki/post/type/${t}/source/${e}`,{params:{client:n,...s}})},getById(t){return Object(i["$cms"])().get("/api/cms/wiki/post/id/"+t)},post(t){return Object(i["$cms"])().post("/api/cms/wiki/post",t)},update(t,e){return Object(i["$cms"])().put("/api/cms/wiki/post/"+t,e)},remove(t){return Object(i["$cms"])().delete("/api/cms/wiki/post/"+t)},versions({type:t,id:e},s){return Object(i["$cms"])().get(`/api/cms/wiki/post/type/${t}/source/${e}/versions`,{params:{client:n,...s}})},async handleMix(t,e,s,i){let a="",n="",o=!0,r=!1,c=[];if("std"===s){const l=await this.get({type:t,id:e},{client:s,...i});return a=l.data.data.post,n=l.data.data.source,c=l.data.data.users,a&&(o=!1),console.log("获取旗舰攻略"),{post:a,source:n,isEmpty:o,compatible:r,type:t,source_id:e,users:c}}{const l=await this.get({type:t,id:e},{client:s,...i});n=l.data.data.source,a=l.data.data.post,c=l.data.data.users,a&&(o=!1),console.log("获取缘起攻略");const u=!!l.data.data.post;return u?{post:a,source:n,isEmpty:o,compatible:r,type:t,source_id:e,users:c}:(console.log("兼容：获取旗舰攻略"),this.get({type:t,id:e},{client:"std",...i}).then(s=>(a=s.data.data.post,n||(n=s.data.data.source),a&&(o=!1),c=s.data.data.users,r=!0,{post:a,source:n,isEmpty:o,compatible:r,type:t,source_id:e,users:c})))}},async mix({type:t,id:e,client:s},i){let n="",o="";if(n="cj"===t?"achievement":"pet"===t?"item":t||"achievement",e){if(o=e,"pet"===t){const t=await a(e,{client:s});let o=t.data,r=o.ItemTabType+"_"+o.ItemTabIndex;return this.handleMix(n,r,s,i)}return this.handleMix(n,o,s,i)}}}},"6e3a":function(t,e,s){},8018:function(t,e,s){"use strict";s("6e3a")},"8a80":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-box"},[e("publish-header",{attrs:{name:"技能百科"}},[t._t("header")],2),e("el-form",{staticClass:"m-publish-post"},[e("div",{staticClass:"m-publish-source"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("选择技能 *")]),e("el-select",{staticClass:"u-source-id",attrs:{disabled:!!t.post.id,filterable:"",remote:"","remote-method":t.search_handle,loading:t.options.loading},model:{value:t.post.source_id,callback:function(e){t.$set(t.post,"source_id",e)},expression:"post.source_id"}},t._l(t.options.sources,(function(s,i){return e("el-option",{key:s.SkillID+""+i,attrs:{label:s.Name,value:s.SkillID}},[e("div",{staticClass:"m-selector-item"},[e("img",{staticClass:"u-icon",attrs:{src:t.icon_url_filter(s.IconID),alt:s.Name}}),e("span",{staticClass:"u-name",domProps:{textContent:t._s(s.Name)}})])])})),1)],1),e("div",{staticClass:"m-publish-remark"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("修订说明 *")]),e("el-input",{attrs:{maxlength:200,minlength:1,"show-word-limit":"",required:"",placeholder:"请简单描述一下本次修订的说明"},model:{value:t.post.remark,callback:function(e){t.$set(t.post,"remark",e)},expression:"post.remark"}})],1),e("div",{staticClass:"m-publish-content"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("百科正文 *")]),e("Tinymce",{attrs:{attachmentEnable:!0,resourceEnable:!0,height:400},model:{value:t.post.content,callback:function(e){t.$set(t.post,"content",e)},expression:"post.content"}},[!t.isLatest&&t.latest.post&&t.current.post?e("el-alert",{staticClass:"m-latest-check",attrs:{type:"warning","show-icon":""},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{staticClass:"u-alert-title"},[t._v("当前百科已经有更新的版本，你的攻略可能已经失效，请先进行比对。")]),e("el-link",{staticClass:"u-view-latest",attrs:{type:"primary",icon:"el-icon-link",href:t.getLink(t.post.source_id),target:"_blank"}},[t._v("查看最新攻略")]),t.latest.post?e("el-link",{staticClass:"u-get-latest",attrs:{icon:"el-icon-download",type:"primary"},on:{click:t.getLatest}},[t._v("获取最新攻略")]):t._e()]},proxy:!0}],null,!1,2238318328)}):t._e()],1)],1),e("div",{staticClass:"m-publish-commit"},[e("el-divider",{attrs:{"content-position":"left"}}),e("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",disabled:t.processing},on:{click:t.toPublish}},[t._v("提交百科 ")])],1)])],1)},a=[],n=s("5530"),o=(s("14d9"),s("b0c0"),s("d3b7"),s("ba82")),r=s("221a"),c=s("500d"),l=s("c9d2"),u=s("85e4"),p=s("da5c"),d={name:"skill",data:function(){return{options:{sources:null},post:{id:"",content:"",source_id:"",remark:""},loading:!1,processing:!1,latest:{},current:{}}},computed:{client:function(){return this.$store.state.client},id:function(){var t;return null===(t=this.$route.query)||void 0===t?void 0:t.post_id},isLatest:function(){var t,e,s,i;return!(null===(t=this.current)||void 0===t||null===(e=t.post)||void 0===e||!e.id||null===(s=this.latest)||void 0===s||null===(i=s.post)||void 0===i||!i.id)&&this.current.post.id==this.latest.post.id}},methods:{toPublish:function(){var t=this;if(this.post.source_id)if(this.post.content)if(this.post.remark){this.processing=!0;var e={source_id:String(this.post.source_id),user_nickname:l["a"].getInfo().name,content:this.post.content,remark:this.post.remark};if(this.id){var s=pick(e,["level","content","remark"]);c["a"].update(this.id,Object(n["a"])(Object(n["a"])({},s),{},{client:this.client})).then((function(e){e=e.data,t.$message({message:"提交成功，请等待审核",type:"success"}),setTimeout((function(){t.$router.push({name:"wiki_post",params:{type:"skill"}})}),500)})).finally((function(){t.processing=!1}))}else c["a"].post(Object(n["a"])(Object(n["a"])({type:"skill"},e),{},{client:this.client})).then((function(e){e=e.data,t.$message({message:"提交成功，请等待审核",type:"success"}),setTimeout((function(){t.$router.push({name:"wiki_post",params:{type:"skill"}})}),500)})).finally((function(){t.processing=!1}))}else this.$message({message:"请简单描述本次修订说明",type:"warning"});else this.$message({message:"要编写百科正文哦",type:"warning"});else this.$message({message:"请选择要修订百科的技能",type:"warning"})},icon_url_filter:function(t){return Object(u["iconLink"])(t)},search_handle:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.loading=!0,Object(p["c"])({Name:e}).then((function(e){t.options.sources=e.data.list,t.loading=!1}))},loadData:function(t){var e=this;if(this.post.source_id)return this.loading=!0,c["a"].get({type:"skill",id:this.post.source_id},{client:t}).then((function(t){var s=t.data,i=s.data.post,a=s.data.source;if(i?(e.post.source_id=parseInt(i.source_id),e.post.remark=i.remark,e.post.content=i.content):(e.post.source_id=e.post.source_id?parseInt(e.post.source_id):"",e.post.remark="",e.post.content=""),a){var n=!1;for(var o in e.options.sources=e.options.sources||[],e.options.sources)if(e.options.sources[o].SkillID==a.SkillID){n=!0;break}n||e.options.sources.push(a)}return i})).finally((function(){e.loading=!1}))},loadDataByPostId:function(){var t=this;return this.loading=!0,c["a"].getById(this.id).then((function(e){t.current=e.data.data;var s=e.data,i=s.data.post,a=s.data.source;if(i?(t.post.source_id=parseInt(i.source_id),t.post.remark=i.remark,t.post.content=i.content):(t.post.source_id=t.post.source_id?parseInt(t.post.source_id):"",t.post.remark="",t.post.content=""),a){var n=!1;for(var o in t.options.sources=t.options.sources||[],t.options.sources)if(t.options.sources[o].SkillID==a.SkillID){n=!0;break}n||t.options.sources.push(a)}return i})).finally((function(){t.loading=!1}))},loadLatest:function(){var t=this;this.post.source_id&&c["a"].get({type:"skill",id:this.post.source_id}).then((function(e){t.latest=e.data.data}))},getLink:function(t){return Object(u["getLink"])("skill",t)},getLatest:function(){var t;this.post.content=(null===(t=this.latest.post)||void 0===t?void 0:t.content)||""}},created:function(){this.search_handle();var t=this.$route.params.id;this.post.source_id=t?parseInt(t):null,this.loadLatest()},watch:{"post.source_id":{handler:function(t){var e=this;this.id?this.loadDataByPostId():"std"==this.client?this.loadData("std"):this.loadData("origin").then((function(t){console.log("兼容获取"),t||e.loadData("std")}))}}},components:{"publish-header":o["a"],Tinymce:r["a"]}},m=d,h=(s("8018"),s("2877")),f=Object(h["a"])(m,i,a,!1,null,"cd617db4",null);e["default"]=f.exports},da5c:function(t,e,s){"use strict";s.d(e,"b",(function(){return a})),s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){return o}));s("99af");var i=s("41cb");function a(t,e){var s=isNaN(t)?"name":"id";return Object(i["$node"])().get("/skill/".concat(s,"/").concat(t),{params:e}).then((function(t){return t.data})).catch((function(t){console.log(t)}))}function n(t){return Object(i["$node"])().get("/skill",{params:t})}function o(t){return Object(i["$node"])().get("/v2/kungfu/panel",{params:t})}}}]);