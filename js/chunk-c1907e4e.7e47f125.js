(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c1907e4e"],{"0a51":function(t,e,a){"use strict";a("3cb2")},"3cb2":function(t,e,a){},a75b:function(t,e,a){"use strict";a.r(e);a("b0c0");var i=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-publish-box m-publish-box-face"},[e("publish-header",{attrs:{name:"体型分享"}}),e("el-form",{attrs:{"label-position":"left","label-width":"90px"}},[e("publish-title",{model:{value:t.post.title,callback:function(e){t.$set(t.post,"title",e)},expression:"post.title"}}),e("div",{staticClass:"m-publish-info"},[e("el-divider",{attrs:{"content-position":"left"}},[t._v("信息")]),e("el-form-item",{attrs:{label:"体型码"}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0,"active-color":"#13ce66"},model:{value:t.post.code_mode,callback:function(e){t.$set(t.post,"code_mode",e)},expression:"post.code_mode"}})],1),t.post.code_mode?e("el-form-item",{attrs:{prop:"code"},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[t._v("体型码")]),e("i",{staticClass:"el-icon-document-copy",staticStyle:{"margin-left":"2px",color:"#c00"},on:{click:t.codePaste}})]},proxy:!0}])},[e("el-input",{attrs:{placeholder:"请输入体型码"},model:{value:t.post.code,callback:function(e){t.$set(t.post,"code",e)},expression:"post.code"}})],1):e("el-form-item",{attrs:{label:"数据"}},[e("face-attachment",{attrs:{body:t.post.body_type,type:"body"},on:{"update:data":t.handleBodyChange}}),t._l(t.bodyAttachments,(function(a){return e("div",{key:a.id,staticClass:"u-attachment"},[e("el-button",{staticClass:"u-main",attrs:{type:a.file===t.bodyData.file?"warning":"",icon:"el-icon-star-off",circle:"",plain:a.file!==t.bodyData.file,size:"mini",title:"设为主数据"},on:{click:function(e){return t.setMain(a)}}}),e("span",{staticClass:"u-attachment-text"},[t._v("文件名: "),e("b",[t._v(t._s(a.name))])]),e("span",{staticClass:"u-attachment-remark"},[e("el-input",{attrs:{placeholder:"备注",size:"mini"},model:{value:a.describe,callback:function(e){t.$set(a,"describe",e)},expression:"item.describe"}})],1),e("el-button",{staticClass:"u-btn",attrs:{type:"info",icon:"el-icon-delete",circle:"",plain:"",size:"mini",title:"移除"},on:{click:function(e){return t.removeFile(a.id)}}})],1)}))],2),e("el-form-item",{attrs:{label:"版本"}},[e("el-radio-group",{model:{value:t.post.client,callback:function(e){t.$set(t.post,"client",e)},expression:"post.client"}},[e("el-radio",{attrs:{label:"std"}},[t._v("剑三")])],1)],1),e("publish-original",{model:{value:t.post.original,callback:function(e){t.$set(t.post,"original",e)},expression:"post.original"}}),e("el-form-item",{attrs:{label:"首发",prop:"is_fr"}},[e("el-switch",{attrs:{"active-color":"#13ce66","active-value":1,"inactive-value":0},model:{value:t.post.is_fr,callback:function(e){t.$set(t.post,"is_fr",e)},expression:"post.is_fr"}})],1),t.post.original?t._e():[e("el-form-item",{attrs:{label:"原作者名称",prop:"author_name"}},[e("el-input",{attrs:{placeholder:"输入原作者名称"},model:{value:t.post.author_name,callback:function(e){t.$set(t.post,"author_name",e)},expression:"post.author_name"}})],1),e("el-form-item",{attrs:{label:"原作者链接",prop:"author_link"}},[e("el-input",{attrs:{placeholder:"输入原作者链接"},model:{value:t.post.author_link,callback:function(e){t.$set(t.post,"author_link",e)},expression:"post.author_link"}})],1)],e("el-form-item",{attrs:{label:"是否收费"},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[t._v("是否收费")]),e("el-tooltip",{attrs:{content:"仅签约作者可以发布收费作品"}},[e("i",{staticClass:"el-icon-warning-outline",staticStyle:{"margin-left":"2px",color:"#c00"}})])]},proxy:!0}])},[e("el-radio-group",{attrs:{disabled:!t.isSuperAuthor},model:{value:t.post.price_type,callback:function(e){t.$set(t.post,"price_type",e)},expression:"post.price_type"}},[e("el-radio",{attrs:{label:"0"}},[t._v("免费")]),t.cny_enable?e("el-radio",{attrs:{label:"2"}},[t._v("收费(金箔)")]):t._e()],1),"0"!=t.post.price_type?e("el-input-number",{staticClass:"u-price",attrs:{size:"small",max:3e3,min:0},model:{value:t.post.price_count,callback:function(e){t.$set(t.post,"price_count",e)},expression:"post.price_count"}}):t._e(),"0"!=t.post.price_type&&t.post.price_count>0?e("div",{staticClass:"u-tip-box"},[e("div",{staticClass:"u-warning"},[e("el-checkbox",{attrs:{disabled:""},model:{value:t.promise,callback:function(e){t.promise=e},expression:"promise"}},[t._v(" 我承诺该上传属于自己的原创作品或已得到原作者授权，且相关信息中不带有非授权的元素（比如贴图、字体）等，若违反法律规定我将承担全部责任，魔盒有权下架作品。 ")])],1)]):t._e()],1),e("el-form-item",{attrs:{label:"体型"}},[e("el-radio-group",{model:{value:t.post.body_type,callback:function(e){t.$set(t.post,"body_type",e)},expression:"post.body_type"}},t._l(t.bodyMap,(function(a,i){return e("el-radio",{key:i,attrs:{label:~~i}},[t._v(" "+t._s(a.label)+" ")])})),1)],1),e("el-form-item",{attrs:{label:"描述"}},[e("el-input",{attrs:{placeholder:"请填写描述",type:"textarea",rows:3},model:{value:t.post.remark,callback:function(e){t.$set(t.post,"remark",e)},expression:"post.remark"}})],1),e("el-divider",{attrs:{"content-position":"left"}},[t._v("扩展")]),e("el-form-item",{attrs:{label:"图片列表"}},[e("UploadAlbum",{model:{value:t.post.images,callback:function(e){t.$set(t.post,"images",e)},expression:"post.images"}})],1),t.isSuperAuthor?e("publish-banner",{model:{value:t.post.banner,callback:function(e){t.$set(t.post,"banner",e)},expression:"post.banner"}}):t._e()],2),e("div",{staticClass:"m-publish-buttons"},[e("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:t.publish}},[t._v("发    布")])],1)],1)],1)},o=[],s=a("5530"),n=a("c14f"),l=a("1da1"),c=(a("7db0"),a("d81d"),a("14d9"),a("e9f5"),a("f665"),a("ab43"),a("e9c4"),a("a9e3"),a("d3b7"),a("85e4"),a("3891")),r=a("ba82"),p=a("800a"),d=a("cb9d"),u=a("c17e"),b=a("7b4a"),m=a("fb0e"),h=a("fb5f"),f=a("c9d2"),y=a("0644"),v=a.n(y),_=a("ccee"),g={name:"pvxbody",components:{publishHeader:r["a"],publishTitle:p["a"],publishOriginal:d["a"],faceAttachment:u["a"],UploadAlbum:b["a"],publishBanner:m["a"]},data:function(){return{post:{original:1,is_fr:1,author_name:"",author_link:"",title:"",remark:"",banner:"",client:"std",body_type:1,data:"",file:"",cover:"",images:[],related:[],price_type:"0",price_count:0,code_mode:0,code:""},loading:!1,processing:!1,postId:"",postType:"body",bodyMap:h["bodyMap"],promise:!0,bodyAttachments:[],bodyData:"",isSuperAuthor:!1,cny_enable:0}},computed:{id:function(){return this.$route.params.id},client:function(){return this.$store.state.client}},mounted:function(){var t=this;return Object(l["a"])(Object(n["a"])().m((function e(){return Object(n["a"])().w((function(e){while(1)switch(e.n){case 0:return t.init(),e.n=1,f["a"].isSuperAuthor();case 1:t.isSuperAuthor=e.v;case 2:return e.a(2)}}),e)})))()},methods:{init:function(){var t=this;this.id?this.getData():this.post.client=this.client,Object(_["e"])("cny_enable").then((function(e){t.cny_enable=Number(e.data.data.val)}))},getData:function(){var t=this;this.loading=!0,Object(c["e"])(this.id).then((function(e){t.post=e.data.data,t.post.images=t.post.images.map((function(t){return{name:t,url:t}})),Object(c["d"])(t.id).then((function(e){var a=e.data;a&&a.data&&(t.bodyAttachments=a.data.map((function(t){return{id:t.id,file:t.uuid,name:t.name,describe:t.describe||"",data:t.data||""}})),t.bodyData=t.bodyAttachments.find((function(e){return e.file==t.post.file}))),t.loading=!1}))}))},handleBodyChange:function(t){var e=t.object,a=void 0===e?null:e,i=t.json,o=void 0===i?"":i,s=t.uuid,n=void 0===s?"":s,l=t.id,c=void 0===l?"":l,r=t.name,p=void 0===r?"":r;this.bodyAttachments.push({id:c,file:n,name:p,data:o,body_type:a["nRoleType"],describe:""}),this.bodyData||(this.bodyData={id:c,file:n,name:p,data:o,body_type:a["nRoleType"]},this.post.body_type=a["nRoleType"])},validator:function(t){var e,a=["title"],i=["请填写标题"];t.code_mode?(a.push("code"),i.push("请填写体型码")):(a.push("file"),i.push("请上传数据"));for(var o=0;o<a.length;o++)if(!t[a[o]]){e=i[o];break}return!e||(this.$message.warning(e),!1)},publish:function(){var t=this;this.processing=!0;var e=Object(s["a"])(Object(s["a"])({},this.post),{},{images:this.post.images.map((function(t){return t.url||t}))}),a=this.bodyAttachments.map((function(t){return{id:t.id,describe:t.describe,data:t.data}}));this.bodyData&&(this.bodyData.data&&(e.data=JSON.stringify(this.bodyData.data)),e.body_type=this.bodyData.body_type||this.post.body_type,e.file=this.bodyData.file),e.attachments=a,this.validator(e)?this.id?Object(c["g"])(this.id,e).then((function(e){t.$message.success("修改成功"),t.processing=!1,setTimeout((function(){location.href="/body/".concat(t.id)}),500)})).finally((function(){t.processing=!1})):Object(c["a"])(e).then((function(e){t.$message({message:"发布成功",type:"success"}),t.processing=!1,setTimeout((function(){location.href="/body/".concat(e.data.data.id)}),500)})):this.processing=!1},removeFile:function(t){for(var e=[],a=0;a<this.bodyAttachments.length;a++)this.bodyAttachments[a].id!=t&&e.push(this.bodyAttachments[a]);this.bodyAttachments=e,this.bodyData.id==t&&(this.bodyData="")},setMain:function(t){this.bodyData=v()(t),this.$notify({title:"设置成功",type:"success",duration:2e3})},codePaste:function(){var t=this;return Object(l["a"])(Object(n["a"])().m((function e(){var a,i;return Object(n["a"])().w((function(e){while(1)switch(e.n){case 0:return e.p=0,e.n=1,navigator.clipboard.readText();case 1:a=e.v,t.post.code=a,e.n=3;break;case 2:e.p=2,i=e.v,console.error("Failed to read clipboard contents: ",i);case 3:return e.a(2)}}),e,null,[[0,2]])})))()}}},k=g,x=(a("0a51"),a("2877")),w=Object(x["a"])(k,i,o,!1,null,null,null);e["default"]=w.exports}}]);