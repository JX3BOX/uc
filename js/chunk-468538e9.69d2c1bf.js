(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-468538e9"],{3244:function(t,i,e){"use strict";e("6de3")},"6de3":function(t,i,e){},8357:function(t,i,e){"use strict";e.r(i);e("ac1f"),e("841c");var a=function(){var t=this,i=t._self._c;return i("div",{staticClass:"m-dashboard m-dashboard-profile m-dashboard-work m-dashboard-whitelist m-whitelist"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-whitelist-primary"},[t._m(0),i("el-tabs",{on:{"tab-click":t.tabChange},model:{value:t.active,callback:function(i){t.active=i},expression:"active"}},[i("el-tab-pane",{attrs:{label:"我的亲友",name:"whitelist"}}),i("el-tab-pane",{attrs:{label:"黑名单",name:"blacklist"}}),i("el-tab-pane",{attrs:{label:"我的关注",name:"myfollow"}}),i("el-tab-pane",{attrs:{label:"我的粉丝",name:"myfans"}})],1),"whitelist"!==t.active?i("el-input",{staticClass:"m-privacy-search",attrs:{placeholder:"请输入搜索内容",clearable:""},on:{clear:t.handleChange},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.handleChange.apply(null,arguments)}},model:{value:t.keyword,callback:function(i){t.keyword=i},expression:"keyword"}},[i("template",{slot:"prepend"},[t._v("关键词")]),i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleChange},slot:"append"})],2):t._e(),t.list&&t.list.length?i("div",{staticClass:"m-whitelist-list u-list"},t._l(t.list,(function(e,a){return i("div",{key:e.kith_id||e.id,staticClass:"u-item"},[i("a",{staticClass:"u-item-pic",attrs:{href:t.userLink(e),target:"_blank"}},[i("img",{staticClass:"u-item-avatar",attrs:{src:t._f("showAvatar")(t.getAvatar(e))}})]),i("a",{staticClass:"u-item-name",attrs:{href:t.userLink(e),target:"_blank"}},[t._v(t._s(t.getName(e)))]),"whitelist"===t.active?[e.status?i("span",{staticClass:"u-item-remark"},[t._v("备注："+t._s(e.remark||"无"))]):i("span",{staticClass:"u-item-remark"},[i("i",{staticClass:"el-icon-loading"}),t._v(" 等待确认中... ")])]:t._e(),i("div",{staticClass:"u-item-btns"},["whitelist"===t.active?[i("el-popconfirm",{attrs:{title:"确认删除亲友关系吗？"},on:{confirm:function(i){return t.remove(e.kith_id,a)}}},[i("el-button",{attrs:{slot:"reference",type:"warning",size:"mini",icon:"el-icon-delete"},slot:"reference"},[t._v("删除")])],1),i("el-button",{staticClass:"u-btn-edit",attrs:{size:"mini",icon:"el-icon-edit"},on:{click:function(i){return t.edit(e.kith_id,e)}}},[t._v("编辑")])]:[i("el-button",{staticClass:"u-btn-delete",attrs:{size:"mini",icon:"el-icon-delete"},on:{click:function(i){return t.removeOther(e)}}},[t._v("移除")])]],2)],2)})),0):t._e(),"whitelist"!==t.active?i("el-pagination",{attrs:{background:"","hide-on-single-page":"","current-page":t.pagination.pageIndex,total:t.pagination.total},on:{"current-change":t.currentChange}}):t._e()],1),"myfans"!==t.active?i("div",{staticClass:"m-whitelist-sidebar"},[i("div",{staticClass:"u-title"},[i("i",{staticClass:"el-icon-news"}),t._v(" "+t._s(t.sideTitle)+" ")]),i("el-input",{staticClass:"u-input",attrs:{placeholder:"输入UID添加","suffix-icon":"el-icon-search"},on:{change:t.search},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.uid,callback:function(i){t.uid=t._n(i)},expression:"uid"}}),t.userdata?i("div",{staticClass:"u-list"},[i("div",{staticClass:"u-item"},[i("img",{staticClass:"u-item-avatar",attrs:{src:t._f("showAvatar")(t.userdata.user_avatar),alt:t.userdata.display_name}}),i("div",{staticClass:"u-item-info"},[i("span",{staticClass:"u-item-uid"},[t._v("UID："+t._s(t.userdata.ID))]),i("b",{staticClass:"u-item-name"},[t._v(t._s(t.userdata.display_name))])]),t.isNewKith?t._e():i("i",{staticClass:"u-item-exist"},[t._v("已添加")])])]):t._e(),t.isNull?i("div",{staticClass:"u-null"},[i("el-alert",{attrs:{title:"无搜索结果",type:"info","show-icon":"",closable:!1}})],1):t._e(),i("el-button",{staticClass:"u-submit",attrs:{type:"success",disabled:"wihtelist"===t.active&&!t.allowAppend},on:{click:t.add}},[t._v(t._s(t.btnText))])],1):t._e()])},n=[function(){var t=this,i=t._self._c;return i("h2",{staticClass:"m-whitelist-title u-title"},[i("i",{staticClass:"el-icon-ship"}),t._v(" 隐私设置 ")])}],s=(e("99af"),e("caad"),e("d81d"),e("14d9"),e("4e82"),e("a434"),e("e9f5"),e("ab43"),e("d3b7"),e("2532"),e("41cb"));function l(){return Object(s["$cms"])().get("/api/cms/user/kith/my")}function r(t){return Object(s["$cms"])().get("/api/cms/user/".concat(t,"/info"))}function o(t){return Object(s["$cms"])().post("/api/cms/user/kith/".concat(t))}function c(t){return Object(s["$cms"])().delete("/api/cms/user/kith/".concat(t))}function u(t,i){return Object(s["$cms"])().put("/api/cms/user/kith/".concat(t),i)}function d(t){return Object(s["$next"])().get("/api/my-userlist/deny",{params:t})}function h(t){return Object(s["$next"])().post("/api/my-userlist/follow/".concat(t))}function f(t){return Object(s["$next"])().post("/api/my-userlist/deny/".concat(t))}function p(t){return Object(s["$next"])().delete("/api/my-userlist/deny/".concat(t))}function m(t){return Object(s["$next"])().get("/api/next2/rss/my-subscribers",{params:t})}function v(t){return Object(s["$next"])().get("/api/next2/rss/list",{params:t})}function y(t){return Object(s["$next"])().delete("/api/next2/rss/my-subscribers/".concat(t))}function b(t,i){return Object(s["$next"])().post("/api/next2/rss/subscribe/author/".concat(t),i)}function g(t){return Object(s["$next"])().delete("/api/next2/rss/subscribe/author/".concat(t))}var _=e("c9d2"),k=e("85e4"),w={name:"privacy",props:[],data:function(){return{list:[],loading:!1,uid:"",userdata:"",flag:!1,limit_map:{member:5,vip:20,pro:100},identity:"member",active:"whitelist",keyword:"",pagination:{pageIndex:1,pageSize:10,total:0}}},computed:{allowAppend:function(){return this.userdata&&this.total<this.limit&&this.isNewKith},isNewKith:function(){var t,i=null===(t=this.userdata)||void 0===t?void 0:t.ID;return!this.currentIdList.includes(i)},currentIdList:function(){return this.list.map((function(t){return t.kith_id}))},limit:function(){return this.limit_map[this.identity]||5},total:function(){var t;return null===(t=this.list)||void 0===t?void 0:t.length},isNull:function(){return this.uid&&!this.userdata&&this.flag},fns:function(){return{blacklist:d,myfans:m}},removeFns:function(){return{blacklist:p,myfollow:g,myfans:y}},addFns:function(){return{blacklist:f,myfollow:h,whitelist:o}},btnText:function(){return{blacklist:"拉黑",myfollow:"关注",whitelist:"添加亲友 (".concat(this.total," / ").concat(this.limit,")")}[this.active]},sideTitle:function(){return{blacklist:"添加黑名单",myfollow:"添加关注",whitelist:"添加亲友"}[this.active]},userId:function(){return _["a"].getInfo().uid}},methods:{handleChange:function(){this.pagination.pageIndex=1,this.loadList()},tabChange:function(){this.keyword=this.$route.query.keyword||"",this.pagination.pageIndex=1,this.loadList()},currentChange:function(t){this.pagination.pageIndex=t,this.loadList()},search:function(t){var i=this;t&&!isNaN(t)&&(this.flag=!1,r(t).then((function(t){i.userdata=t.data.data})).finally((function(){i.flag=!0})))},add:function(){var t=this;this.userdata?"myfollow"===this.active?b(this.userdata.ID,{title:this.userdata.display_name}).then((function(i){t.loadList()})):this.addFns[this.active](this.userdata.ID).then((function(i){t.loadList()})):this.$notify({title:"提示",message:"请先输入UID进行搜索",type:"warning"})},addKith:function(){var t=this;this.allowAppend&&o(this.uid).then((function(){t.$notify({title:"成功",message:"添加成功",type:"success"}),t.list.push({kith_id:t.uid,level:0,status:0,kith_info:t.userdata})}))},follow:function(){var t=this;h(this.userdata.ID).then((function(){t.$notify({title:"成功",message:"关注成功",type:"success"}),t.loadList()}))},deny:function(){var t=this;f(this.userdata.ID).then((function(){t.$notify({title:"成功",message:"拉黑成功",type:"success"}),t.loadList()}))},loadList:function(){var t=this;if(this.loading=!0,this.$router.push({name:"privacy",query:{tab:this.active}}),"whitelist"===this.active)l().then((function(i){var e=i.data.data;e=e.sort((function(t,i){return i.level-t.level})),t.list=e})).finally((function(){t.loading=!1}));else if("myfollow"===this.active){var i={index:this.pagination.pageIndex,pageSize:this.pagination.pageSize,q:this.keyword,category:2};v(i).then((function(i){t.list=i.data.data.list||[],t.pagination.total=i.data.data.page.total})).finally((function(){t.loading=!1}))}else{var e={pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize,display_name:this.keyword};this.fns[this.active](e).then((function(i){t.list=i.data.data.list||[],t.pagination.total=i.data.data.page.total})).finally((function(){t.loading=!1}))}},remove:function(t,i){var e=this;c(t).then((function(){e.$notify({title:"成功",message:"删除成功",type:"success"}),e.list.splice(i,1)}))},edit:function(t,i){var e=this;this.$prompt("请输入备注","设置",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(a){var n=a.value;u(t,{remark:n}).then((function(){e.$notify({title:"成功",message:"编辑成功",type:"success"}),i.remark=n}))}))},removeOther:function(t){var i=this,e={blacklist:"确认解除对该用户的屏蔽？",myfollow:"确认不再订阅该用户？",myfans:"确认要移除粉丝？"};this.$confirm(e[this.active],"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){var e="";e="whitelist"===i.active?t.kith_id:"myfans"===i.active?t.user_id:"blacklist"===i.active?t.bind_user_id:t.author_id,i.removeFns[i.active](e).then((function(){i.$notify({title:"成功",message:"操作成功",type:"success"}),i.loadList()}))})).finally((function(){}))},userLink:function(t){var i="";return i="whitelist"===this.active?t.kith_id:"myfans"===this.active?t.user_id:"blacklist"===this.active?t.bind_user_id:t.author_id,Object(k["authorLink"])(i)},getAvatar:function(t){var i,e;return"myfans"==this.active?null===(i=t.user_info)||void 0===i?void 0:i.avatar:"myfollow"==this.active?null===(e=t.author_info)||void 0===e?void 0:e.avatar:(t.kith_info||t).user_avatar},getName:function(t){var i,e;return"myfans"==this.active?null===(i=t.user_info)||void 0===i?void 0:i.display_name:"myfollow"==this.active?null===(e=t.author_info)||void 0===e?void 0:e.display_name:(t.kith_info||t).display_name}},mounted:function(){var t=this;this.active=this.$route.query.tab||"whitelist",this.loadList(),_["a"].getAsset().then((function(i){_["a"]._isPRO(i)?t.identity="pro":_["a"]._isVIP(i)?t.identity="vip":t.identity="member"}))},filters:{showAvatar:function(t){return Object(k["showAvatar"])(t,"m")},authorLink:k["authorLink"]}},C=w,x=(e("3244"),e("2877")),$=Object(x["a"])(C,a,n,!1,null,"6fac0ea6",null);i["default"]=$.exports}}]);