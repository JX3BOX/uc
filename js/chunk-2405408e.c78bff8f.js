(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2405408e"],{1441:function(t,e,i){"use strict";i("d2ca")},"1acc":function(t,e,i){"use strict";i("e33e")},2396:function(t,e,i){},"2cf1":function(t,e,i){},7479:function(t,e,i){},b807:function(t,e,i){},ba82:function(t,e,i){"use strict";i("b0c0");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-header"},[e("el-page-header",{attrs:{content:t.name},on:{back:t.goBack}}),t._t("default")],2)},n=[],s=(i("14d9"),{name:"publish_header",props:["name"],data:function(){return{}},computed:{},methods:{goBack:function(){var t=this;this.$router.go(-1);var e=this.$route.fullPath;setTimeout((function(){t.$route.fullPath===e&&t.$router.push("/")}),100)}},mounted:function(){},components:{}}),l=s,c=(i("f436"),i("2877")),o=Object(c["a"])(l,a,n,!1,null,null,null);e["a"]=o.exports},c69e:function(t,e,i){"use strict";i("b807")},d2ca:function(t,e,i){},dd83:function(t,e,i){"use strict";i("2cf1")},e2fd:function(t,e,i){"use strict";i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return l})),i.d(e,"b",(function(){return s}));var a=i("41cb");function n(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s={keyword:t,limit:e,fields:i};return null!==n&&(s.is_equip=n?1:0),Object(a["$node"])().get("/item/search",{params:s})}function s(t){return Object(a["$node"])().get("/item/search",{params:t}).then((function(t){return t.data.data}))}function l(t){if(t)return Object(a["$node"])().get("/item/id/".concat(t))}},e33e:function(t,e,i){},e9fe:function(t,e,i){"use strict";i.r(e);var a=i("53ca"),n=(i("a4d3"),i("e01a"),i("a434"),i("498a"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-publish-box"},[e("publish-header",{attrs:{name:"物品清单",localDraft:!1}},[t._t("header")],2),e("el-form",{staticClass:"u-form",attrs:{"label-position":"left","label-width":"80px"}},[e("el-form-item",{attrs:{label:"标题"}},[e("el-input",{attrs:{placeholder:"请输入物品清单的标题",maxlength:"20","show-word-limit":""},model:{value:t.data.title,callback:function(e){t.$set(t.data,"title",e)},expression:"data.title"}})],1),e("el-form-item",{attrs:{label:"可见性"}},[e("el-radio",{attrs:{label:1},model:{value:t.data.public,callback:function(e){t.$set(t.data,"public",e)},expression:"data.public"}},[t._v("公开")]),e("el-radio",{attrs:{label:0},model:{value:t.data.public,callback:function(e){t.$set(t.data,"public",e)},expression:"data.public"}},[t._v("私有")])],1),e("el-form-item",{attrs:{label:"描述"}},[e("el-input",{attrs:{type:"textarea",rows:3,placeholder:"简单说明一下你的物品清单",maxlength:2e3,"show-word-limit":""},model:{value:t.data.description,callback:function(e){t.$set(t.data,"description",e)},expression:"data.description"}})],1),e("el-form-item",{attrs:{label:"类型"}},[e("el-radio-group",{attrs:{size:"medium"},on:{change:t.resetPages},model:{value:t.data.type,callback:function(e){t.$set(t.data,"type",e)},expression:"data.type"}},[e("el-radio-button",{attrs:{label:"1"}},[t._v("道具清单")]),e("el-radio-button",{attrs:{label:"2"}},[t._v("装备清单")])],1),e("el-button",{staticClass:"u-add-plan",attrs:{size:"medium",icon:"el-icon-plus"},on:{click:t.addRelation}},[t._v("新增分组")])],1),e("el-form-item",{attrs:{label:"清单"}},[e("div",{staticClass:"m-plan-list"},[t.searchList.length?e("div",{staticClass:"u-list-search"},[e("el-input",{staticClass:"u-title",attrs:{placeholder:"请输入物品名称（可适配中括号）","prefix-icon":"el-icon-search"},model:{value:t.keyword,callback:function(e){t.keyword="string"===typeof e?e.trim():e},expression:"keyword"}}),e("draggable",{attrs:{draggable:".u-change",move:t.moveHandle,group:{name:"draggable-item",pull:"clone",put:!1}},model:{value:t.searchList,callback:function(e){t.searchList=e},expression:"searchList"}},t._l(t.searchList,(function(t,i){return e("jx3-item-simple",{key:i,staticClass:"u-change",attrs:{item:t}})})),1),e("el-pagination",{staticClass:"m-archive-pages",attrs:{small:"",background:"",layout:"prev, pager, next, jumper","hide-on-single-page":!0,"page-size":t.per,total:t.total,"current-page":t.page,size:"mini"},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e}}})],1):t._e(),"1"==t.data.type?e("el-row",{staticClass:"u-list-box",attrs:{gutter:20}},t._l(t.data.relation,(function(i,a){return e("el-col",{key:a,attrs:{span:6}},[e("div",{staticClass:"u-list"},[e("i",{staticClass:"u-list-close el-icon-circle-close",on:{click:function(e){return t.data.relation.splice(a,1)}}}),e("el-input",{staticClass:"u-title",attrs:{type:"text",placeholder:"子清单标题（选填）",maxlength:"20","show-word-limit":""},model:{value:i.title,callback:function(e){t.$set(i,"title",e)},expression:"relation.title"}}),e("draggable",{staticClass:"u-item-drag",attrs:{list:i.data,group:"draggable-item","ghost-class":"ghost"}},[i.data&&i.data.length?t._l(i.data,(function(a,n){return e("div",{key:n,staticClass:"u-selected u-selected-item u-selected-count"},[e("itemIcon",{staticClass:"u-icon",attrs:{item_id:a.id}}),e("div",{staticClass:"u-count"},[e("span",[t._v("数量：")]),e("el-input-number",{attrs:{size:"mini",min:1,label:"数字"},model:{value:a.count,callback:function(e){t.$set(a,"count",t._n(e))},expression:"item.count"}})],1),e("i",{staticClass:"u-close el-icon-circle-close",on:{click:function(t){return i.data.splice(n,1)}}})],1)})):e("div",{staticClass:"u-normal"},[t._v("拖拽所需道具到此处")])],2)],1)])})),1):e("el-row",{staticClass:"u-list-box u-list-equip",attrs:{gutter:20}},t._l(t.equipList,(function(i,n){return e("el-col",{key:n,attrs:{span:6}},t._l(i,(function(i,n){return e("div",{key:n,staticClass:"u-list"},[e("div",{staticClass:"u-title"},[t._v(t._s(i.label))]),e("draggable",{attrs:{list:i.list,move:t.moveHandle,"data-AucGenre":i.AucGenre,"data-AucSubType":i.AucSubType,group:"draggable-item","ghost-class":"ghost"}},[i.list&&i.list.length?t._l(i.list,(function(n,s){return e("div",{key:s,staticClass:"u-selected u-selected-item u-selected-equip"},["string"==typeof n?e("itemIcon",{staticClass:"u-icon",attrs:{item_id:n}}):t._e(),"object"==Object(a["a"])(n)?e("itemIcon",{staticClass:"u-icon",attrs:{item:n}}):t._e(),e("i",{staticClass:"u-close el-icon-circle-close",on:{click:function(t){return i.list.splice(s,1)}}})],1)})):e("div",{staticClass:"u-normal"},[t._v("拖拽所需道具到此处")])],2)],1)})),0)})),1)],1)]),e("el-form-item",[e("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",loading:t.loading},on:{click:t.submit}},[t._v("提交物品清单")])],1)],1)],1)}),s=[],l=(i("99af"),i("d81d"),i("14d9"),i("e9f5"),i("7d54"),i("ab43"),i("d3b7"),i("159b"),i("ba82")),c=function(){var t=this,e=t._self._c;return t.item?e("el-popover",{attrs:{placement:"right-end","popper-class":"m-simple-item-popup",width:"auto","visible-arrow":!1,trigger:"hover",transition:"none","close-delay":0},on:{show:function(e){t.item_id=t.item.id}},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[e("div",{staticClass:"m-simple-item",class:{onlyIcon:t.onlyIcon,withName:t.withName},attrs:{slot:"reference"},on:{mousedown:function(e){t.visible=!1}},slot:"reference"},[e("div",{staticClass:"m-icon"},[e("div",{staticClass:"u-border",style:{backgroundImage:t.item_border(t.item),opacity:5==t.item.Quality?.9:1}}),e("div",{staticClass:"u-border-quest",style:{backgroundImage:t.item_border_quest(t.item)}}),e("img",{staticClass:"u-icon",style:{width:t.iconSize,height:t.iconSize},attrs:{src:t.icon_url(t.item.IconID),alt:"IconID:".concat(t.item.IconID)}})]),e("span",{staticClass:"u-name",style:{color:t.item_color(t.item.Quality)},domProps:{textContent:t._s(t.item.Name)}}),e("span",{staticClass:"u-uiid fr",domProps:{textContent:t._s("ID: ".concat(t.item.id))}})]),e("jx3-item",{attrs:{item_id:t.item_id,"jx3-client-type":t.jx3ClientType}})],1):t._e()},o=[],r=i("c7fa");const{__imgPath:u,__iconPath:d}=i("65c2");var m=t=>isNaN(parseInt(t))?u+"image/common/nullicon.png":`${d}icon/${t}.png`,p=i("1d18");const{__imgPath:b}=i("65c2");var h=t=>{switch(t.Quality){case 3:return`url(${b}image/item/blue.png)`;case 4:return`url(${b}image/item/purple.png)`;case 5:return`url(${b}image/item/orange.gif)`;default:return""}};const{__imgPath:f}=i("65c2");var g=t=>t.IsQuest>0?`url(${f}image/item/renwu.png)`:"",_={name:"ItemSimple",props:["item","onlyIcon","iconSize","withName","jx3ClientType"],data:function(){return{visible:!1,item_id:null}},methods:{icon_url:m,item_color:p["a"],item_border:h,item_border_quest:g},components:{"jx3-item":r["a"]}},v=_,y=(i("1441"),i("fe5d"),i("2877")),k=Object(y["a"])(v,c,o,!1,null,null,null),w=k.exports,C=function(){var t=this,e=t._self._c;return t.source?e("el-popover",{attrs:{placement:"right-start",width:"auto",trigger:t.click_trigger?"click":"hover",disabled:t.dishoverable,"popper-class":"m-item-icon-popup","visible-arrow":!1,transition:"none","close-delay":0},on:{show:t.show}},[e("template",{slot:"reference"},[e("div",{staticClass:"m-item-icon"},[e("div",{staticClass:"u-item-icon"},[e("div",{staticClass:"u-border",style:{backgroundImage:t.item_border(t.source),opacity:5==t.source.Quality?.9:1}}),e("div",{staticClass:"u-border-quest",style:{backgroundImage:t.item_border_quest(t.source)}}),e("img",{staticClass:"u-item-icon",attrs:{src:t.icon_url(t.source.IconID)}})]),e("div",{staticClass:"u-name",class:"quality-".concat(t.source.Quality)},[t._v(t._s(t.source.Name))])])]),e("jx3-item",{attrs:{item:t.source}})],2):t._e()},x=[],I=(i("b64b"),i("e2fd")),A=i("65c2"),j=i("85e4"),$={name:"ItemIcon",props:["item","item_id","dishoverable","click_trigger"],data:function(){return{source:null}},computed:{client:function(){return this.$store.state.client}},components:{"jx3-item":r["a"]},methods:{get_data:function(t){var e=this;t&&Object(I["a"])(t).then((function(t){var i=t.data,a=i.data.item;Object.keys(a).length&&(e.source=a)}))},show:function(){this.source&&"undefined"!==typeof this.source.Genre||this.get_data(this.source.id)},item_border:function(t){switch(t.Quality){case 3:return"url(".concat(A["__imgPath"],"image/item/blue.png)");case 4:return"url(".concat(A["__imgPath"],"image/item/purple.png)");case 5:return"url(".concat(A["__imgPath"],"image/item/orange.gif)");default:return""}},item_border_quest:function(t){return t.IsQuest>0?"url(".concat(A["__imgPath"],"image/item/renwu.png)"):""},icon_url:function(t){return Object(j["iconLink"])(t)}},watch:{item:{immediate:!0,handler:function(){this.source=this.item}},item_id:{immediate:!0,handler:function(){this.get_data(this.item_id)}}}},q=$,O=(i("1acc"),i("dd83"),Object(y["a"])(q,C,x,!1,null,"6eab7321",null)),P=O.exports,S=i("b76a"),G=i.n(S),L=i("49b9"),T={id:"",title:"",public:1,type:"1",description:"",relation:[]},D=[[{title:"melee_weapon",label:"武器",AucGenre:1,list:[]},{title:"range_weapon",label:"暗器",AucGenre:2,list:[]}],[{title:"helm",label:"帽子",AucGenre:3,AucSubType:2,list:[]},{title:"chest",label:"上衣",AucGenre:3,AucSubType:1,list:[]},{title:"waist",label:"腰带",AucGenre:3,AucSubType:3,list:[]}],[{title:"bangle",label:"护腕",AucGenre:3,AucSubType:6,list:[]},{title:"pants",label:"下装",AucGenre:3,AucSubType:4,list:[]},{title:"boots",label:"鞋子",AucGenre:3,AucSubType:5,list:[]}],[{title:"amulet",label:"项链",AucGenre:4,AucSubType:1,list:[]},{title:"pendant",label:"腰坠",AucGenre:4,AucSubType:3,list:[]},{title:"ring_1",label:"戒指",AucGenre:4,AucSubType:2,list:[]},{title:"ring_2",label:"戒指",AucGenre:4,AucSubType:2,list:[]}]],Q={name:"plan",components:{draggable:G.a,"publish-header":l["a"],"jx3-item-simple":w,itemIcon:P},data:function(){return{data:Object.assign({},T),relationList:[],equipList:[].concat(D),loading:!1,keyword:"",per:15,page:1,total:1,searchList:[],item_id:""}},computed:{plan_id:function(){return this.$route.params.plan_id},search_params:function(){var t={page:this.page,limit:this.per,is_equip:2==this.data.type?1:0,fields:["id","UiID","Name","IconID","Quality","AucGenre","AucSubType","Desc"],apply:1};return this.keyword&&(t.keyword=this.keyword),t}},watch:{keyword:function(){this.resetPages()},search_params:{immediate:!0,deep:!0,handler:function(){this.loadItems()}}},methods:{loadItems:function(){var t=this;Object(I["b"])(this.search_params).then((function(e){e.data.map((function(t){return t.count=1})),t.searchList=e.data,t.total=e.total}))},resetPages:function(){this.page=1},iconLink:j["iconLink"],addRelation:function(){this.data.relation.unshift({title:"",data:[]})},moveHandle:function(t){if(!t.to.classList.contains("u-item-drag")){var e=t.to.getAttribute("data-AucGenre"),i=t.to.getAttribute("data-AucSubType"),a=t.draggedContext.element.AucGenre==e;return null!==i&&(a=a&&t.draggedContext.element.AucSubType==i),a}},getPlanData:function(){var t=this;Object(L["d"])(this.plan_id).then((function(e){e=t.extractID(e),console.log(e),t.data=e,2==t.data.type&&t.toEquipList(t.data.relation)}))},extractID:function(t){return 1==t.type?t.relation=t.relation.map((function(t){return t.data=t.data.map((function(t){return"string"==typeof t&&(t={id:t,count:1}),"object"==Object(a["a"])(t)&&(t={id:t.id,count:t.count}),t})),t})):t.relation=this.equipItem(t.relation),t},equipItem:function(t){for(var e in t)t[e]=t[e].map((function(t){return"object"==Object(a["a"])(t)&&(t=t.id),t}));return t},toEquipList:function(t){this.equipList.map((function(e){e.map((function(e){t.hasOwnProperty(e.title)&&(e.list=t[e.title])}))}))},toEquip:function(){var t={};this.equipList.forEach((function(e){e.forEach((function(e){t[e.title]=e.list}))})),t=this.equipItem(t),this.data.relation=t},submit:function(){var t=this;2==this.data.type&&this.toEquip(),this.loading=!0,this.plan_id?Object(L["e"])(this.plan_id,this.data).then((function(){t.$message({message:"物品清单修改成功",type:"success"}),t.$router.push({name:"bucket",params:{type:"item_plan"}})})).finally((function(){t.loading=!1})):Object(L["a"])(this.data).then((function(){t.$message({message:"物品清单提交成功",type:"success"}),t.$router.push({name:"bucket",params:{type:"item_plan"}})})).finally((function(){t.loading=!1}))}},created:function(){this.plan_id&&this.getPlanData()}},z=Q,N=(i("c69e"),Object(y["a"])(z,n,s,!1,null,"8d75a00e",null));e["default"]=N.exports},f436:function(t,e,i){"use strict";i("2396")},fe5d:function(t,e,i){"use strict";i("7479")}}]);