(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-791a44ba"],{8357:function(t,i,e){"use strict";e.r(i);e("b0c0"),e("ac1f"),e("841c");var n=function(){var t=this,i=t._self._c;return i("div",{staticClass:"m-dashboard m-dashboard-profile m-dashboard-work m-dashboard-whitelist m-whitelist"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-whitelist-primary"},[t._m(0),i("el-tabs",{on:{"tab-click":t.tabChange},model:{value:t.active,callback:function(i){t.active=i},expression:"active"}},[t.relationNetTypes.length?t._l(t.relationNetTypes,(function(e,n){return i("el-tab-pane",{key:n,attrs:{label:e.name,name:e.relationship_type}},[t.isRelationNet?i("div",{staticClass:"m-members m-whitelist-list"},t._l(t.members,(function(e,n){return i("div",{key:n,staticClass:"u-item"},[i("a",{staticClass:"u-item-pic",attrs:{href:t.userLink(e),target:"_blank"}},[i("img",{staticClass:"u-item-avatar",attrs:{src:t._f("showAvatar")(t.getAvatar(e))}})]),i("a",{staticClass:"u-item-name",attrs:{href:t.userLink(e),target:"_blank"}},[t._v(t._s(t.getName(e)))]),e.status?t._e():i("span",{staticClass:"u-item-remark"},[t._v(" 等待确认中... "),i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.onCancel(e)}}},[t._v("取消")])],1)])})),0):t._e(),t.waitList.length?i("el-alert",{staticClass:"u-wait-tip",attrs:{title:"您有 ".concat(t.waitList.length," 条邀请待处理！"),type:"warning","show-icon":"",closable:!1},nativeOn:{click:function(i){t.waitVisible=!0}}}):t._e()],1)})):t._e(),i("el-tab-pane",{attrs:{label:"我的亲友",name:"whitelist"}}),i("el-tab-pane",{attrs:{label:"黑名单",name:"blacklist"}}),i("el-tab-pane",{attrs:{label:"我的关注",name:"myfollow"}}),i("el-tab-pane",{attrs:{label:"我的粉丝",name:"myfans"}})],2),t.isRelationNet?t._e():["whitelist"!==t.active?i("el-input",{staticClass:"m-privacy-search",attrs:{placeholder:"请输入搜索内容",clearable:""},on:{clear:t.handleChange},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.handleChange.apply(null,arguments)}},model:{value:t.keyword,callback:function(i){t.keyword=i},expression:"keyword"}},[i("template",{slot:"prepend"},[t._v("关键词")]),i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleChange},slot:"append"})],2):t._e(),t.list&&t.list.length?i("div",{staticClass:"m-whitelist-list u-list"},t._l(t.list,(function(e,n){return i("div",{key:e.kith_id||e.id,staticClass:"u-item"},[i("a",{staticClass:"u-item-pic",attrs:{href:t.userLink(e),target:"_blank"}},[i("img",{staticClass:"u-item-avatar",attrs:{src:t._f("showAvatar")(t.getAvatar(e))}})]),i("a",{staticClass:"u-item-name",attrs:{href:t.userLink(e),target:"_blank"}},[t._v(t._s(t.getName(e)))]),"whitelist"===t.active?[e.status?i("span",{staticClass:"u-item-remark"},[t._v("备注："+t._s(e.remark||"无"))]):i("span",{staticClass:"u-item-remark"},[i("i",{staticClass:"el-icon-loading"}),t._v(" 等待确认中... ")])]:t._e(),i("div",{staticClass:"u-item-btns"},["whitelist"===t.active?[i("el-popconfirm",{attrs:{title:"确认删除亲友关系吗？"},on:{confirm:function(i){return t.remove(e.kith_id,n)}}},[i("el-button",{attrs:{slot:"reference",type:"warning",size:"mini",icon:"el-icon-delete"},slot:"reference"},[t._v("删除")])],1),i("el-button",{staticClass:"u-btn-edit",attrs:{size:"mini",icon:"el-icon-edit"},on:{click:function(i){return t.edit(e.kith_id,e)}}},[t._v("编辑")])]:[i("el-button",{staticClass:"u-btn-delete",attrs:{size:"mini",icon:"el-icon-delete"},on:{click:function(i){return t.removeOther(e)}}},[t._v("移除")])]],2)],2)})),0):t._e(),"whitelist"!==t.active?i("el-pagination",{attrs:{background:"","hide-on-single-page":"","current-page":t.pagination.pageIndex,total:t.pagination.total},on:{"current-change":t.currentChange}}):t._e()]],2),"myfans"!==t.active?i("div",{staticClass:"m-whitelist-sidebar"},[i("div",{staticClass:"u-title"},[i("i",{staticClass:"el-icon-news"}),t._v(" "+t._s(t.sideTitle))]),i("el-input",{staticClass:"u-input",attrs:{placeholder:"输入UID添加","suffix-icon":"el-icon-search"},on:{change:t.search},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.search.apply(null,arguments)}},model:{value:t.uid,callback:function(i){t.uid=t._n(i)},expression:"uid"}}),t.userdata?i("div",{staticClass:"u-list"},[i("div",{staticClass:"u-item"},[i("img",{staticClass:"u-item-avatar",attrs:{src:t._f("showAvatar")(t.userdata.user_avatar),alt:t.userdata.display_name}}),i("div",{staticClass:"u-item-info"},[i("span",{staticClass:"u-item-uid"},[t._v("UID："+t._s(t.userdata.ID))]),i("b",{staticClass:"u-item-name"},[t._v(t._s(t.userdata.display_name))])]),t.isNewKith?t._e():i("i",{staticClass:"u-item-exist"},[t._v("已添加")])])]):t._e(),t.isNull?i("div",{staticClass:"u-null"},[i("el-alert",{attrs:{title:"无搜索结果",type:"info","show-icon":"",closable:!1}})],1):t._e(),i("el-button",{staticClass:"u-submit",attrs:{type:"success",disabled:"wihtelist"===t.active&&!t.allowAppend},on:{click:t.add}},[t._v(t._s(t.btnText))])],1):t._e(),i("el-dialog",{attrs:{title:"待处理列表",visible:t.waitVisible,width:"80%"},on:{"update:visible":function(i){t.waitVisible=i}}},[i("div",{staticClass:"m-whitelist-list m-wait-list"},t._l(t.waitList,(function(e,n){return i("div",{key:n,staticClass:"u-item"},[i("a",{staticClass:"u-item-pic",attrs:{href:t.userLink(e),target:"_blank"}},[i("img",{staticClass:"u-item-avatar",attrs:{src:t._f("showAvatar")(t.getAvatar(e))}})]),i("a",{staticClass:"u-item-name",attrs:{href:t.userLink(e),target:"_blank"}},[t._v(t._s(t.getName(e)))]),e.status?t._e():i("span",{staticClass:"u-item-remark"},[t.members.length?t._e():i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.onAccept(e)}}},[t._v("接受")]),i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.onReject(e)}}},[t._v("拒绝")])],1)])})),0),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(i){t.waitVisible=!1}}},[t._v("取 消")])],1)])],1)},a=[function(){var t=this,i=t._self._c;return i("h2",{staticClass:"m-whitelist-title u-title"},[i("i",{staticClass:"el-icon-ship"}),t._v(" 隐私设置")])}],s=e("c14f"),o=e("1da1"),l=(e("99af"),e("4de4"),e("7db0"),e("caad"),e("d81d"),e("14d9"),e("4e82"),e("a434"),e("e9f5"),e("910d"),e("f665"),e("ab43"),e("d3b7"),e("2532"),e("41cb"));function r(){return Object(l["$cms"])().get("/api/cms/user/kith/my")}function c(t){return Object(l["$cms"])().get("/api/cms/user/".concat(t,"/info"))}function u(t){return Object(l["$cms"])().post("/api/cms/user/kith/".concat(t))}function d(t){return Object(l["$cms"])().delete("/api/cms/user/kith/".concat(t))}function h(t,i){return Object(l["$cms"])().put("/api/cms/user/kith/".concat(t),i)}function f(t){return Object(l["$next"])().get("/api/my-userlist/deny",{params:t})}function v(t){return Object(l["$next"])().post("/api/my-userlist/follow/".concat(t))}function m(t){return Object(l["$next"])().post("/api/my-userlist/deny/".concat(t))}function p(t){return Object(l["$next"])().delete("/api/my-userlist/deny/".concat(t))}function y(t){return Object(l["$next"])().get("/api/next2/rss/my-subscribers",{params:t})}function b(t){return Object(l["$next"])().get("/api/next2/rss/list",{params:t})}function _(t){return Object(l["$next"])().delete("/api/next2/rss/my-subscribers/".concat(t))}function g(t,i){return Object(l["$next"])().post("/api/next2/rss/subscribe/author/".concat(t),i)}function w(t){return Object(l["$next"])().delete("/api/next2/rss/subscribe/author/".concat(t))}function k(){return Object(l["$team"])().get("/api/team/relation-net/types")}function C(t){return Object(l["$team"])().post("/api/team/relation-net/item",t)}function x(t){return Object(l["$team"])().get("/api/team/relation-net/members/by-type/".concat(t))}function N(t,i){return Object(l["$team"])().post("/api/team/relation-net/item/".concat(t,"/invite/user/").concat(i))}function $(t){return Object(l["$team"])().delete("/api/team/relation-net/invite/send-list/item/".concat(t))}function O(){return Object(l["$team"])().get("/api/team/relation-net/invite/todo-list")}function j(t,i){return Object(l["$team"])().put("/api/team/relation-net/item/".concat(t,"/invite/deal-with/").concat(i))}var I=e("c9d2"),T=e("85e4"),L={name:"privacy",props:[],data:function(){return{list:[],loading:!1,uid:"",userdata:"",flag:!1,limit_map:{member:5,vip:20,pro:100},identity:"member",active:"lover",keyword:"",pagination:{pageIndex:1,pageSize:10,total:0},relationNetTypes:[],net:{},members:[],waitList:[],waitVisible:!1}},computed:{isRelationNet:function(){var t=this;return this.relationNetTypes.find((function(i){return i.relationship_type===t.active}))},relationActiveName:function(){var t,i=this;return null===(t=this.relationNetTypes.find((function(t){return t.relationship_type===i.active})))||void 0===t?void 0:t.name},relationId:function(){var t;return(null===(t=this.net)||void 0===t?void 0:t.id)||0},allowAppend:function(){return this.userdata&&this.total<this.limit&&this.isNewKith},isNewKith:function(){var t,i=null===(t=this.userdata)||void 0===t?void 0:t.ID;return!this.currentIdList.includes(i)},currentIdList:function(){return this.list.map((function(t){return t.kith_id}))},limit:function(){return this.limit_map[this.identity]||5},total:function(){var t;return null===(t=this.list)||void 0===t?void 0:t.length},isNull:function(){return this.uid&&!this.userdata&&this.flag},fns:function(){return{blacklist:f,myfans:y}},removeFns:function(){return{blacklist:p,myfollow:w,myfans:_}},addFns:function(){return{blacklist:m,myfollow:v,whitelist:u}},btnText:function(){return this.isRelationNet?"添加":{blacklist:"拉黑",myfollow:"关注",whitelist:"添加亲友 (".concat(this.total," / ").concat(this.limit,")")}[this.active]},sideTitle:function(){return this.isRelationNet?this.relationActiveName:{blacklist:"添加黑名单",myfollow:"添加关注",whitelist:"添加亲友"}[this.active]},userId:function(){return I["a"].getInfo().uid}},methods:{onAccept:function(t){var i=this,e="lover"===this.active?"情缘":"";this.$confirm("是否接受 ".concat(t.creator_info.display_name," 的邀请，成为ta的").concat(e,"？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.loading=!0,j(t.net_id,1).then((function(){i.waitVisible=!1,i.loadRelationNetMembersByType()})).finally((function(){i.loading=!1}))}))},onReject:function(t){var i=this;this.$confirm("是否拒绝 ".concat(t.creator_info.display_name," 的邀请？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.loading=!0,j(t.net_id,2).then((function(){i.loadWaitInvites()})).finally((function(){i.loading=!1}))}))},onCancel:function(t){var i=this;this.loading=!0,$(t.id).then((function(t){i.$notify({title:"取消成功",type:"success"}),i.loadRelationNetMembersByType()})).finally((function(){i.loading=!1}))},loadRelationNetTypes:function(){var t=this;return Object(o["a"])(Object(s["a"])().m((function i(){return Object(s["a"])().w((function(i){while(1)switch(i.n){case 0:return i.n=1,k().then((function(i){var e;t.relationNetTypes=null===(e=i.data.data)||void 0===e?void 0:e.filter((function(t){return t.is_official&&t.is_only_one}))}));case 1:return i.a(2,i.v)}}),i)})))()},handleChange:function(){this.pagination.pageIndex=1,this.loadList()},loadRelationNetMembersByType:function(){var t=this,i=this.active;this.loading=!0,x(i).then((function(i){var e,n;t.members=(null===(e=i.data.data)||void 0===e?void 0:e.members)||[],t.net=(null===(n=i.data.data)||void 0===n?void 0:n.net)||{}})).finally((function(){t.loading=!1}))},loadWaitInvites:function(){var t=this;this.loading=!0,O().then((function(i){var e,n,a;t.waitList=(null===(e=i.data)||void 0===e||null===(n=e.data)||void 0===n||null===(a=n.list)||void 0===a?void 0:a.filter((function(i){var e;return(null===(e=i.net)||void 0===e?void 0:e.relationship_type)===t.active})))||[]})).finally((function(){t.loading=!1}))},tabChange:function(){var t=this;this.relationNetTypes.find((function(i){return i.relationship_type===t.active}))?this.loadRelationNetMembersByType():(this.keyword=this.$route.query.keyword||"",this.pagination.pageIndex=1,this.loadList())},currentChange:function(t){this.pagination.pageIndex=t,this.loadList()},search:function(t){var i=this;t&&!isNaN(t)&&(this.flag=!1,c(t).then((function(t){i.userdata=t.data.data})).finally((function(){i.flag=!0})))},inviteUser:function(){var t=this;this.relationId&&(this.loading=!0,N(this.relationId,this.userdata.ID).then((function(){t.$notify({title:"已发送邀请",type:"success"}),t.loadRelationNetMembersByType()})).finally((function(){t.loading=!1})))},add:function(){var t=this;this.userdata?this.isRelationNet?this.members.length?this.inviteUser():C({relationship_type:"lover"}).then((function(i){t.inviteUser()})):"myfollow"===this.active?g(this.userdata.ID,{title:this.userdata.display_name}).then((function(i){t.loadList()})):this.addFns[this.active](this.userdata.ID).then((function(i){t.loadList()})):this.$notify({title:"提示",message:"请先输入UID进行搜索",type:"warning"})},addKith:function(){var t=this;this.allowAppend&&u(this.uid).then((function(){t.$notify({title:"成功",message:"添加成功",type:"success"}),t.list.push({kith_id:t.uid,level:0,status:0,kith_info:t.userdata})}))},follow:function(){var t=this;v(this.userdata.ID).then((function(){t.$notify({title:"成功",message:"关注成功",type:"success"}),t.loadList()}))},deny:function(){var t=this;m(this.userdata.ID).then((function(){t.$notify({title:"成功",message:"拉黑成功",type:"success"}),t.loadList()}))},loadList:function(){var t=this;if(this.loading=!0,this.$router.push({name:"privacy",query:{tab:this.active}}),"whitelist"===this.active)r().then((function(i){var e=i.data.data;e=e.sort((function(t,i){return i.level-t.level})),t.list=e})).finally((function(){t.loading=!1}));else if("myfollow"===this.active){var i={index:this.pagination.pageIndex,pageSize:this.pagination.pageSize,q:this.keyword,category:2};b(i).then((function(i){t.list=i.data.data.list||[],t.pagination.total=i.data.data.page.total})).finally((function(){t.loading=!1}))}else{var e={pageIndex:this.pagination.pageIndex,pageSize:this.pagination.pageSize,display_name:this.keyword};this.fns[this.active](e).then((function(i){t.list=i.data.data.list||[],t.pagination.total=i.data.data.page.total})).finally((function(){t.loading=!1}))}},remove:function(t,i){var e=this;d(t).then((function(){e.$notify({title:"成功",message:"删除成功",type:"success"}),e.list.splice(i,1)}))},edit:function(t,i){var e=this;this.$prompt("请输入备注","设置",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(n){var a=n.value;h(t,{remark:a}).then((function(){e.$notify({title:"成功",message:"编辑成功",type:"success"}),i.remark=a}))}))},removeOther:function(t){var i=this,e={blacklist:"确认解除对该用户的屏蔽？",myfollow:"确认不再订阅该用户？",myfans:"确认要移除粉丝？"};this.$confirm(e[this.active],"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){var e="";e="whitelist"===i.active?t.kith_id:"myfans"===i.active?t.user_id:"blacklist"===i.active?t.bind_user_id:t.author_id,i.removeFns[i.active](e).then((function(){i.$notify({title:"成功",message:"操作成功",type:"success"}),i.loadList()}))})).finally((function(){}))},userLink:function(t){var i,e="";this.isRelationNet?e=t.user_id||(null===(i=t.creator_info)||void 0===i?void 0:i.id):e="whitelist"===this.active?t.kith_id:"myfans"===this.active?t.user_id:"blacklist"===this.active?t.bind_user_id:t.author_id;return Object(T["authorLink"])(e)},getAvatar:function(t){var i,e,n,a;return this.isRelationNet?(null===(i=t.user_info)||void 0===i?void 0:i.avatar)||(null===(e=t.creator_info)||void 0===e?void 0:e.avatar):"myfans"==this.active?null===(n=t.user_info)||void 0===n?void 0:n.avatar:"myfollow"==this.active?null===(a=t.author_info)||void 0===a?void 0:a.avatar:(t.kith_info||t).user_avatar},getName:function(t){var i,e,n,a;return this.isRelationNet?(null===(i=t.user_info)||void 0===i?void 0:i.display_name)||(null===(e=t.creator_info)||void 0===e?void 0:e.display_name):"myfans"==this.active?null===(n=t.user_info)||void 0===n?void 0:n.display_name:"myfollow"==this.active?null===(a=t.author_info)||void 0===a?void 0:a.display_name:(t.kith_info||t).display_name}},mounted:function(){var t=this;this.loadRelationNetTypes().then((function(){if(t.relationNetTypes.length){var i,e=(null===(i=t.relationNetTypes.find((function(i){return i.relationship_type===t.$route.query.tab})))||void 0===i?void 0:i.relationship_type)||"lover";t.active=e,t.loadRelationNetMembersByType(),t.loadWaitInvites()}else t.active=t.$route.query.tab||"whitelist",t.loadList()})),I["a"].getAsset().then((function(i){I["a"]._isPRO(i)?t.identity="pro":I["a"]._isVIP(i)?t.identity="vip":t.identity="member"}))},filters:{showAvatar:function(t){return Object(T["showAvatar"])(t,"m")},authorLink:T["authorLink"]}},R=L,A=(e("def7"),e("2877")),B=Object(A["a"])(R,n,a,!1,null,"03f4d1bf",null);i["default"]=B.exports},b4e3:function(t,i,e){},def7:function(t,i,e){"use strict";e("b4e3")}}]);